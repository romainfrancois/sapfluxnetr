<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Custom aggregation • sapfluxnetr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Custom aggregation">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sapfluxnetr</a>
        <span class="version label label-warning" data-toggle="tooltip" data-placement="bottom" title="Not yet in CRAN">0.0.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/custom-aggregation.html">Custom aggregation</a>
    </li>
    <li>
      <a href="../articles/data-flags.html">Data Flags</a>
    </li>
    <li>
      <a href="../articles/memory-and-parallelization.html">Memory and Parallelization</a>
    </li>
    <li>
      <a href="../articles/metadata-and-data-units.html">Metadata and Data units</a>
    </li>
    <li>
      <a href="../articles/sapfluxnetr-quick-guide.html">sapfluxnetr (Not So) Quick Guide</a>
    </li>
    <li>
      <a href="../articles/sfn-data-classes.html">sfn_data classes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sapfluxnet/sapfluxnetr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Custom aggregation</h1>
                        <h4 class="author">Victor Granda (Sapfluxnet Team)</h4>
            
            <h4 class="date">2019-03-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sapfluxnet/sapfluxnetr/blob/master/vignettes/custom-aggregation.Rmd"><code>vignettes/custom-aggregation.Rmd</code></a></small>
      <div class="hidden name"><code>custom-aggregation.Rmd</code></div>

    </div>

    
    
<p><code>sapfluxnetr</code> package offers a very flexible but powerful system based on <code>tidyverse</code> and <code>tibbletime</code> packages to aggregate and summarise the site/s data in the form of the <code>sfn_metrics</code> functions. All the metrics family of functions (<code><a href="../reference/metrics.html">?metrics</a></code>) make use of <code>sfn_metrics</code> under the hood. If you want full control to the statistics returned and aggregation periodswe recommend you to use this main function. This vignette will show you how.</p>
<div id="pre-fixed-summarising-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#pre-fixed-summarising-functions" class="anchor"></a>Pre-fixed summarising functions</h2>
<ol style="list-style-type: decimal">
<li><code>daily_metrics</code></li>
<li><code>monthly_metrics</code></li>
<li><code>predawn_metrics</code></li>
<li><code>midday_metrics</code></li>
<li><code>nightly_metrics</code></li>
<li><code>daylight_metrics</code></li>
</ol>
<p>See each function help for a detailed description and examples of use.</p>
</div>
<div id="custom-summarising-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#custom-summarising-functions" class="anchor"></a>Custom summarising functions</h2>
<p><code>daily_metrics</code> and related functions return a complete set of metrics ready for use, but if you want simpler metrics and/or avoid the computational burden of returning all the pre-fixed metrics you can supply your own summarising functions using the <code>funs</code> function belonging to the <code>dplyr</code> package in the <code>tidyverse</code> suite:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># libraries</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sapfluxnetr)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb1-12" title="12"></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">### only mean and sd at a daily scale</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co"># data</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">'ARG_TRE'</span>, <span class="dt">package =</span> <span class="st">'sapfluxnetr'</span>)</a>
<a class="sourceLine" id="cb1-16" title="16"></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="co"># summarising funs (built with funs function from dplyr package)</span></a>
<a class="sourceLine" id="cb1-18" title="18">custom_funs &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="dt">mean =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(., <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">std_dev =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/sd">sd</a></span>(., <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1-19" title="19"></a>
<a class="sourceLine" id="cb1-20" title="20"><span class="co"># metrics</span></a>
<a class="sourceLine" id="cb1-21" title="21">foo_simpler_metrics &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sfn_metrics.html">sfn_metrics</a></span>(</a>
<a class="sourceLine" id="cb1-22" title="22">  ARG_TRE,</a>
<a class="sourceLine" id="cb1-23" title="23">  <span class="dt">period =</span> <span class="st">'daily'</span>,</a>
<a class="sourceLine" id="cb1-24" title="24">  <span class="dt">.funs =</span> custom_funs,</a>
<a class="sourceLine" id="cb1-25" title="25">  <span class="dt">solar =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb1-26" title="26">  <span class="dt">interval =</span> <span class="st">'general'</span></a>
<a class="sourceLine" id="cb1-27" title="27">)</a>
<a class="sourceLine" id="cb1-28" title="28"><span class="co">#&gt; [1] "Crunching data for ARG_TRE. In large datasets this could take a while"</span></a>
<a class="sourceLine" id="cb1-29" title="29"><span class="co">#&gt; [1] "General data for ARG_TRE"</span></a>
<a class="sourceLine" id="cb1-30" title="30"></a>
<a class="sourceLine" id="cb1-31" title="31">foo_simpler_metrics[[<span class="st">'sapf'</span>]]</a>
<a class="sourceLine" id="cb1-32" title="32"><span class="co">#&gt; # A time tibble: 14 x 9</span></a>
<a class="sourceLine" id="cb1-33" title="33"><span class="co">#&gt; # Index: TIMESTAMP</span></a>
<a class="sourceLine" id="cb1-34" title="34"><span class="co">#&gt;    TIMESTAMP           ARG_TRE_Nan_Jt_… ARG_TRE_Nan_Jt_… ARG_TRE_Nan_Jt_…</span></a>
<a class="sourceLine" id="cb1-35" title="35"><span class="co">#&gt;    &lt;dttm&gt;                         &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb1-36" title="36"><span class="co">#&gt;  1 2009-11-17 00:00:00             308.             173.             303.</span></a>
<a class="sourceLine" id="cb1-37" title="37"><span class="co">#&gt;  2 2009-11-18 00:00:00             507.             376.             432.</span></a>
<a class="sourceLine" id="cb1-38" title="38"><span class="co">#&gt;  3 2009-11-19 00:00:00             541.             380.             391.</span></a>
<a class="sourceLine" id="cb1-39" title="39"><span class="co">#&gt;  4 2009-11-20 00:00:00             330.             218.             272.</span></a>
<a class="sourceLine" id="cb1-40" title="40"><span class="co">#&gt;  5 2009-11-21 00:00:00             338.             219.             278.</span></a>
<a class="sourceLine" id="cb1-41" title="41"><span class="co">#&gt;  6 2009-11-22 00:00:00             384.             243.             310.</span></a>
<a class="sourceLine" id="cb1-42" title="42"><span class="co">#&gt;  7 2009-11-23 00:00:00             492.             300.             390.</span></a>
<a class="sourceLine" id="cb1-43" title="43"><span class="co">#&gt;  8 2009-11-24 00:00:00             573.             389.             497.</span></a>
<a class="sourceLine" id="cb1-44" title="44"><span class="co">#&gt;  9 2009-11-25 00:00:00             601.             400.             484.</span></a>
<a class="sourceLine" id="cb1-45" title="45"><span class="co">#&gt; 10 2009-11-26 00:00:00             502.             360.             450.</span></a>
<a class="sourceLine" id="cb1-46" title="46"><span class="co">#&gt; 11 2009-11-27 00:00:00             544.             411.             506.</span></a>
<a class="sourceLine" id="cb1-47" title="47"><span class="co">#&gt; 12 2009-11-28 00:00:00             573.             451.             589.</span></a>
<a class="sourceLine" id="cb1-48" title="48"><span class="co">#&gt; 13 2009-11-29 00:00:00             371.             285.             357.</span></a>
<a class="sourceLine" id="cb1-49" title="49"><span class="co">#&gt; 14 2009-11-30 00:00:00             386.             293.             381.</span></a>
<a class="sourceLine" id="cb1-50" title="50"><span class="co">#&gt; # … with 5 more variables: ARG_TRE_Nan_Jt_4_mean &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb1-51" title="51"><span class="co">#&gt; #   ARG_TRE_Nan_Jt_1_std_dev &lt;dbl&gt;, ARG_TRE_Nan_Jt_2_std_dev &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb1-52" title="52"><span class="co">#&gt; #   ARG_TRE_Nan_Jt_3_std_dev &lt;dbl&gt;, ARG_TRE_Nan_Jt_4_std_dev &lt;dbl&gt;</span></a></code></pre></div>
<p>You can also select if the “special interest” intervals (predawn, midday, nighttime or daylight) are calculated or not. For example, if you are only interested in the midday interval you can use:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">foo_simpler_metrics_midday &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sfn_metrics.html">sfn_metrics</a></span>(</a>
<a class="sourceLine" id="cb2-2" title="2">  ARG_TRE,</a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="dt">period =</span> <span class="st">'daily'</span>,</a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="dt">.funs =</span> custom_funs,</a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="dt">solar =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="dt">interval =</span> <span class="st">'midday'</span>, <span class="dt">int_start =</span> <span class="dv">11</span>, <span class="dt">int_end =</span> <span class="dv">13</span></a>
<a class="sourceLine" id="cb2-7" title="7">)</a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">#&gt; [1] "Crunching data for ARG_TRE. In large datasets this could take a while"</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">#&gt; [1] "midday data for ARG_TRE"</span></a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11">foo_simpler_metrics_midday[[<span class="st">'sapf'</span>]]</a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">#&gt; # A tibble: 13 x 9</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co">#&gt;    TIMESTAMP_md        ARG_TRE_Nan_Jt_… ARG_TRE_Nan_Jt_… ARG_TRE_Nan_Jt_…</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co">#&gt;    &lt;dttm&gt;                         &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="co">#&gt;  1 2009-11-18 00:00:00             685.             665.             614.</span></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="co">#&gt;  2 2009-11-19 00:00:00             879.             594.             626.</span></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co">#&gt;  3 2009-11-20 00:00:00             438.             272.             258.</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="co">#&gt;  4 2009-11-21 00:00:00             631.             379.             533.</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="co">#&gt;  5 2009-11-22 00:00:00             783.             535.             680.</span></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="co">#&gt;  6 2009-11-23 00:00:00             841.             478.             618.</span></a>
<a class="sourceLine" id="cb2-21" title="21"><span class="co">#&gt;  7 2009-11-24 00:00:00             951.             636.             789.</span></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="co">#&gt;  8 2009-11-25 00:00:00             907.             602.             789.</span></a>
<a class="sourceLine" id="cb2-23" title="23"><span class="co">#&gt;  9 2009-11-26 00:00:00             861.             697.             925.</span></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="co">#&gt; 10 2009-11-27 00:00:00             806.             594.             706.</span></a>
<a class="sourceLine" id="cb2-25" title="25"><span class="co">#&gt; 11 2009-11-28 00:00:00             837.             730.             925.</span></a>
<a class="sourceLine" id="cb2-26" title="26"><span class="co">#&gt; 12 2009-11-29 00:00:00             638.             605.             666.</span></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="co">#&gt; 13 2009-11-30 00:00:00             548.             371.             444.</span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="co">#&gt; # … with 5 more variables: ARG_TRE_Nan_Jt_4_mean_md &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-29" title="29"><span class="co">#&gt; #   ARG_TRE_Nan_Jt_1_std_dev_md &lt;dbl&gt;, ARG_TRE_Nan_Jt_2_std_dev_md &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="co">#&gt; #   ARG_TRE_Nan_Jt_3_std_dev_md &lt;dbl&gt;, ARG_TRE_Nan_Jt_4_std_dev_md &lt;dbl&gt;</span></a></code></pre></div>
<blockquote>
<p>When supplying only one function names of variables are not changed to contain the metric name at the end, as the summary function returns the same columns as the original data</p>
</blockquote>
</div>
<div id="custom-aggregation-periods" class="section level2">
<h2 class="hasAnchor">
<a href="#custom-aggregation-periods" class="anchor"></a>Custom aggregation periods</h2>
<p><code>period</code> argument in <code>sfn_metrics</code> is passed to <code>collapse_index</code> function in the <code>tibbletime</code> package, and so, it can use the same input:</p>
<ul>
<li>“frequency period” format, where frequency is a number and period is an interval as character (i.e. “1 year” same as “yearly”, “7 days”)</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># weekly</span></a>
<a class="sourceLine" id="cb3-2" title="2">foo_weekly &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sfn_metrics.html">sfn_metrics</a></span>(</a>
<a class="sourceLine" id="cb3-3" title="3">  ARG_TRE,</a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="dt">period =</span> <span class="st">'7 days'</span>,</a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="dt">.funs =</span> custom_funs,</a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="dt">solar =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="dt">interval =</span> <span class="st">'general'</span></a>
<a class="sourceLine" id="cb3-8" title="8">)</a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co">#&gt; [1] "Crunching data for ARG_TRE. In large datasets this could take a while"</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="co">#&gt; [1] "General data for ARG_TRE"</span></a>
<a class="sourceLine" id="cb3-11" title="11"></a>
<a class="sourceLine" id="cb3-12" title="12">foo_weekly[[<span class="st">'env'</span>]]</a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co">#&gt; # A time tibble: 3 x 19</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co">#&gt; # Index: TIMESTAMP</span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="co">#&gt;   TIMESTAMP           ta_mean rh_mean vpd_mean sw_in_mean ws_mean</span></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="co">#&gt;   &lt;dttm&gt;                &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="co">#&gt; 1 2009-11-15 00:00:00    4.81    35.3    0.598       280.    15.5</span></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="co">#&gt; 2 2009-11-22 00:00:00    6.15    35.3    0.656       327.    24.5</span></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="co">#&gt; 3 2009-11-29 00:00:00    2.55    40.9    0.453       261.    23.1</span></a>
<a class="sourceLine" id="cb3-20" title="20"><span class="co">#&gt; # … with 13 more variables: precip_mean &lt;dbl&gt;, swc_shallow_mean &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb3-21" title="21"><span class="co">#&gt; #   ppfd_in_mean &lt;dbl&gt;, ext_rad_mean &lt;dbl&gt;, ta_std_dev &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb3-22" title="22"><span class="co">#&gt; #   rh_std_dev &lt;dbl&gt;, vpd_std_dev &lt;dbl&gt;, sw_in_std_dev &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb3-23" title="23"><span class="co">#&gt; #   ws_std_dev &lt;dbl&gt;, precip_std_dev &lt;dbl&gt;, swc_shallow_std_dev &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb3-24" title="24"><span class="co">#&gt; #   ppfd_in_std_dev &lt;dbl&gt;, ext_rad_std_dev &lt;dbl&gt;</span></a></code></pre></div>
<ul>
<li>A vector of dates as period boundaries. This way you can build irregular or custom periods.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># custom</span></a>
<a class="sourceLine" id="cb4-2" title="2">foo_custom &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sfn_metrics.html">sfn_metrics</a></span>(</a>
<a class="sourceLine" id="cb4-3" title="3">  ARG_TRE,</a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="dt">period =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.POSIXlt">as.POSIXct</a></span>(</a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'2009-11-17 00:00:00'</span>, <span class="st">'2009-11-22 14:00:00'</span>, <span class="st">'2009-11-30 23:59:00'</span>),</a>
<a class="sourceLine" id="cb4-6" title="6">                      <span class="dt">tz =</span> <span class="st">'UTC'</span></a>
<a class="sourceLine" id="cb4-7" title="7">  ),</a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="dt">.funs =</span> custom_funs,</a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="dt">solar =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb4-10" title="10">  <span class="dt">interval =</span> <span class="st">'general'</span></a>
<a class="sourceLine" id="cb4-11" title="11">)</a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt; [1] "Crunching data for ARG_TRE. In large datasets this could take a while"</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt; [1] "General data for ARG_TRE"</span></a>
<a class="sourceLine" id="cb4-14" title="14">foo_custom[[<span class="st">'sapf'</span>]]</a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">#&gt; # A time tibble: 2 x 9</span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">#&gt; # Index: TIMESTAMP</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">#&gt;   TIMESTAMP           ARG_TRE_Nan_Jt_… ARG_TRE_Nan_Jt_… ARG_TRE_Nan_Jt_…</span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="co">#&gt;   &lt;dttm&gt;                         &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="co">#&gt; 1 2009-11-17 00:00:00             419.             290.             338.</span></a>
<a class="sourceLine" id="cb4-20" title="20"><span class="co">#&gt; 2 2009-11-22 14:00:00             501.             355.             450.</span></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co">#&gt; # … with 5 more variables: ARG_TRE_Nan_Jt_4_mean &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="co">#&gt; #   ARG_TRE_Nan_Jt_1_std_dev &lt;dbl&gt;, ARG_TRE_Nan_Jt_2_std_dev &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-23" title="23"><span class="co">#&gt; #   ARG_TRE_Nan_Jt_3_std_dev &lt;dbl&gt;, ARG_TRE_Nan_Jt_4_std_dev &lt;dbl&gt;</span></a></code></pre></div>
</div>
<div id="extra-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#extra-parameters" class="anchor"></a>Extra parameters</h2>
<p><code>sfn_metrics</code> has a <code>...</code> parameter intended to supply additional parameters to the internal functions used:</p>
<ol style="list-style-type: decimal">
<li>
<p><code><a href="https://www.rdocumentation.org/packages/tibbletime/topics/collapse_index">tibbletime::collapse_index</a></code> accepts the following extra arguments:</p>
<ul>
<li>
<code>start_date</code><br>
NULL by default in the sfn_metrics implementation</li>
<li>
<code>side</code><br>
“start” by default in the sfn_metrics implementation</li>
<li>
<code>clean</code><br>
TRUE by default in the sfn_metrics implementation</li>
</ul>
</li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">dplyr::summarise_all</a></code> accepts extra arguments intended to be applied to the summarising functions provided (to <strong>all</strong>, so they all must have the argument provided or an error will be raised). That’s the reason because we recommend to use the <code>funs</code> function from <code>dplyr</code>, as the arguments are specified for the individual functions.</p></li>
</ol>
<p>For example, if we want the TIMESTAMPs after aggregation to show the end of the period instead the beggining (default) we can do the following:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">foo_simpler_metrics_end &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sfn_metrics.html">sfn_metrics</a></span>(</a>
<a class="sourceLine" id="cb5-2" title="2">  ARG_TRE,</a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="dt">period =</span> <span class="st">'daily'</span>,</a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="dt">.funs =</span> custom_funs,</a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="dt">solar =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="dt">interval =</span> <span class="st">'general'</span>,</a>
<a class="sourceLine" id="cb5-7" title="7">  <span class="dt">side =</span> <span class="st">"end"</span></a>
<a class="sourceLine" id="cb5-8" title="8">)</a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">#&gt; [1] "Crunching data for ARG_TRE. In large datasets this could take a while"</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">#&gt; [1] "General data for ARG_TRE"</span></a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12">foo_simpler_metrics_end[[<span class="st">'sapf'</span>]]</a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">#&gt; # A time tibble: 14 x 9</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">#&gt; # Index: TIMESTAMP</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&gt;    TIMESTAMP           ARG_TRE_Nan_Jt_… ARG_TRE_Nan_Jt_… ARG_TRE_Nan_Jt_…</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">#&gt;    &lt;dttm&gt;                         &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">#&gt;  1 2009-11-18 00:00:00             308.             173.             303.</span></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="co">#&gt;  2 2009-11-19 00:00:00             507.             376.             432.</span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="co">#&gt;  3 2009-11-20 00:00:00             541.             380.             391.</span></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="co">#&gt;  4 2009-11-21 00:00:00             330.             218.             272.</span></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">#&gt;  5 2009-11-22 00:00:00             338.             219.             278.</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="co">#&gt;  6 2009-11-23 00:00:00             384.             243.             310.</span></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="co">#&gt;  7 2009-11-24 00:00:00             492.             300.             390.</span></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="co">#&gt;  8 2009-11-25 00:00:00             573.             389.             497.</span></a>
<a class="sourceLine" id="cb5-25" title="25"><span class="co">#&gt;  9 2009-11-26 00:00:00             601.             400.             484.</span></a>
<a class="sourceLine" id="cb5-26" title="26"><span class="co">#&gt; 10 2009-11-27 00:00:00             502.             360.             450.</span></a>
<a class="sourceLine" id="cb5-27" title="27"><span class="co">#&gt; 11 2009-11-28 00:00:00             544.             411.             506.</span></a>
<a class="sourceLine" id="cb5-28" title="28"><span class="co">#&gt; 12 2009-11-29 00:00:00             573.             451.             589.</span></a>
<a class="sourceLine" id="cb5-29" title="29"><span class="co">#&gt; 13 2009-11-30 00:00:00             371.             285.             357.</span></a>
<a class="sourceLine" id="cb5-30" title="30"><span class="co">#&gt; 14 2009-12-01 00:00:00             386.             293.             381.</span></a>
<a class="sourceLine" id="cb5-31" title="31"><span class="co">#&gt; # … with 5 more variables: ARG_TRE_Nan_Jt_4_mean &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb5-32" title="32"><span class="co">#&gt; #   ARG_TRE_Nan_Jt_1_std_dev &lt;dbl&gt;, ARG_TRE_Nan_Jt_2_std_dev &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb5-33" title="33"><span class="co">#&gt; #   ARG_TRE_Nan_Jt_3_std_dev &lt;dbl&gt;, ARG_TRE_Nan_Jt_4_std_dev &lt;dbl&gt;</span></a></code></pre></div>
<p>If it is compared with the <code>foo_simpler_metrics</code> calculated before, now the period is identified in the TIMESTAMP by the ending of the period (daily in this case).</p>
</div>
<div id="temporary-columns-helpers" class="section level2">
<h2 class="hasAnchor">
<a href="#temporary-columns-helpers" class="anchor"></a>Temporary columns helpers</h2>
<p>The internal aggregation process in <code>sfn_metrics</code> generates some transitory columns which can be used in the summarising functions:</p>
<div id="timestamp_coll" class="section level3">
<h3 class="hasAnchor">
<a href="#timestamp_coll" class="anchor"></a><code>TIMESTAMP_coll</code>
</h3>
<p>When aggregating by the declared period (i.e. <code>"daily"</code>), the TIMESTAMP column collapses to the period start/end value (meaning that all the TIMESTAMP values for the same day becomes identical).<br>
This makes impossible to use any summarise functions that obtain the time of the day at which one event happens (i.e. time of the day at which the maximum sap flow occurs) because all TIMESTAMP values are identical. For that kind of summarising functions, a transitory column called <code>TIMESTAMP_coll</code> is created. So in this case we can create a function that takes de variable values for the day, the TIMESTAMP_coll values for the day and return the TIMESTAMP at which the max sap flow occurs and use it with <code>sfn_metrics</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">max_time &lt;-<span class="st"> </span><span class="cf">function</span>(x, time) {</a>
<a class="sourceLine" id="cb6-2" title="2">  </a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="co"># x: vector of values for a day</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="co"># time: TIMESTAMP for the day </span></a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="co"># if all the values in x are NAs (a daily summmarise of no measures day for</span></a>
<a class="sourceLine" id="cb6-7" title="7">  <span class="co"># example) this will return a length 0 POSIXct vector, which will crash</span></a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="co"># dplyr summarise step. So, check if all NA and if true return NA as POSIXct</span></a>
<a class="sourceLine" id="cb6-9" title="9">  <span class="cf">if</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all">all</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(x))) {</a>
<a class="sourceLine" id="cb6-10" title="10">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.POSIXlt">as.POSIXct</a></span>(<span class="ot">NA</span>, <span class="dt">tz =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attr">attr</a></span>(time, <span class="st">'tz'</span>), <span class="dt">origin =</span> lubridate<span class="op">::</span>origin))</a>
<a class="sourceLine" id="cb6-11" title="11">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb6-12" title="12">    time[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which.min">which.max</a></span>(x)]</a>
<a class="sourceLine" id="cb6-13" title="13">  }</a>
<a class="sourceLine" id="cb6-14" title="14">}</a>
<a class="sourceLine" id="cb6-15" title="15"></a>
<a class="sourceLine" id="cb6-16" title="16">custom_funs &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="dt">max =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(., <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="kw"><a href="../reference/time_at_events.html">max_time</a></span>(., TIMESTAMP_coll))</a>
<a class="sourceLine" id="cb6-17" title="17"></a>
<a class="sourceLine" id="cb6-18" title="18">max_time_metrics &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sfn_metrics.html">sfn_metrics</a></span>(</a>
<a class="sourceLine" id="cb6-19" title="19">  ARG_TRE,</a>
<a class="sourceLine" id="cb6-20" title="20">  <span class="dt">period =</span> <span class="st">'daily'</span>,</a>
<a class="sourceLine" id="cb6-21" title="21">  <span class="dt">.funs =</span> custom_funs,</a>
<a class="sourceLine" id="cb6-22" title="22">  <span class="dt">solar =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-23" title="23">  <span class="dt">interval =</span> <span class="st">'general'</span></a>
<a class="sourceLine" id="cb6-24" title="24">)</a>
<a class="sourceLine" id="cb6-25" title="25"><span class="co">#&gt; [1] "Crunching data for ARG_TRE. In large datasets this could take a while"</span></a>
<a class="sourceLine" id="cb6-26" title="26"><span class="co">#&gt; [1] "General data for ARG_TRE"</span></a>
<a class="sourceLine" id="cb6-27" title="27"></a>
<a class="sourceLine" id="cb6-28" title="28">max_time_metrics[[<span class="st">'sapf'</span>]]</a>
<a class="sourceLine" id="cb6-29" title="29"><span class="co">#&gt; # A time tibble: 14 x 9</span></a>
<a class="sourceLine" id="cb6-30" title="30"><span class="co">#&gt; # Index: TIMESTAMP</span></a>
<a class="sourceLine" id="cb6-31" title="31"><span class="co">#&gt;    TIMESTAMP           ARG_TRE_Nan_Jt_… ARG_TRE_Nan_Jt_… ARG_TRE_Nan_Jt_…</span></a>
<a class="sourceLine" id="cb6-32" title="32"><span class="co">#&gt;    &lt;dttm&gt;                         &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb6-33" title="33"><span class="co">#&gt;  1 2009-11-17 00:00:00             322.             190.             313.</span></a>
<a class="sourceLine" id="cb6-34" title="34"><span class="co">#&gt;  2 2009-11-18 00:00:00             778.             715.             679.</span></a>
<a class="sourceLine" id="cb6-35" title="35"><span class="co">#&gt;  3 2009-11-19 00:00:00            1015.             694.             633.</span></a>
<a class="sourceLine" id="cb6-36" title="36"><span class="co">#&gt;  4 2009-11-20 00:00:00             648.             401.             442.</span></a>
<a class="sourceLine" id="cb6-37" title="37"><span class="co">#&gt;  5 2009-11-21 00:00:00             664.             406.             539.</span></a>
<a class="sourceLine" id="cb6-38" title="38"><span class="co">#&gt;  6 2009-11-22 00:00:00             812.             564.             816.</span></a>
<a class="sourceLine" id="cb6-39" title="39"><span class="co">#&gt;  7 2009-11-23 00:00:00            1085.             676.             935.</span></a>
<a class="sourceLine" id="cb6-40" title="40"><span class="co">#&gt;  8 2009-11-24 00:00:00             992.             736.            1115.</span></a>
<a class="sourceLine" id="cb6-41" title="41"><span class="co">#&gt;  9 2009-11-25 00:00:00             976.             646.             951.</span></a>
<a class="sourceLine" id="cb6-42" title="42"><span class="co">#&gt; 10 2009-11-26 00:00:00             932.             766.            1087.</span></a>
<a class="sourceLine" id="cb6-43" title="43"><span class="co">#&gt; 11 2009-11-27 00:00:00             862.             704.             921.</span></a>
<a class="sourceLine" id="cb6-44" title="44"><span class="co">#&gt; 12 2009-11-28 00:00:00             845.             763.            1165.</span></a>
<a class="sourceLine" id="cb6-45" title="45"><span class="co">#&gt; 13 2009-11-29 00:00:00             714.             747.             701.</span></a>
<a class="sourceLine" id="cb6-46" title="46"><span class="co">#&gt; 14 2009-11-30 00:00:00             875.             646.             919.</span></a>
<a class="sourceLine" id="cb6-47" title="47"><span class="co">#&gt; # … with 5 more variables: ARG_TRE_Nan_Jt_4_max &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb6-48" title="48"><span class="co">#&gt; #   ARG_TRE_Nan_Jt_1_max_time &lt;dttm&gt;, ARG_TRE_Nan_Jt_2_max_time &lt;dttm&gt;,</span></a>
<a class="sourceLine" id="cb6-49" title="49"><span class="co">#&gt; #   ARG_TRE_Nan_Jt_3_max_time &lt;dttm&gt;, ARG_TRE_Nan_Jt_4_max_time &lt;dttm&gt;</span></a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#pre-fixed-summarising-functions">Pre-fixed summarising functions</a></li>
      <li><a href="#custom-summarising-functions">Custom summarising functions</a></li>
      <li><a href="#custom-aggregation-periods">Custom aggregation periods</a></li>
      <li><a href="#extra-parameters">Extra parameters</a></li>
      <li><a href="#temporary-columns-helpers">Temporary columns helpers</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Víctor Granda, Rafael Poyatos, Víctor Flo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
