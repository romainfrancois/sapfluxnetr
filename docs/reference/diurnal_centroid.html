<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Diurnal centroid calculation — diurnal_centroid • sapfluxnetr</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  
<meta property="og:title" content="Diurnal centroid calculation — diurnal_centroid" />

<meta property="og:description" content="Calculate the diurnal centroid for sapflow variables" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sapfluxnetr</a>
        <span class="version label label-warning" data-toggle="tooltip" data-placement="bottom" title="Not yet in CRAN">0.0.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/custom-aggregation.html">Custom aggregation</a>
    </li>
    <li>
      <a href="../articles/data-flags.html">Data Flags</a>
    </li>
    <li>
      <a href="../articles/memory-and-parallelization.html">Memory and Parallelization</a>
    </li>
    <li>
      <a href="../articles/metadata-and-data-units.html">Metadata and Data units</a>
    </li>
    <li>
      <a href="../articles/sapfluxnetr-quick-guide.html">sapfluxnetr (Not So) Quick Guide</a>
    </li>
    <li>
      <a href="../articles/sfn-data-classes.html">sfn_data classes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/sapfluxnet/sapfluxnetr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Diurnal centroid calculation</h1>
    <small class="dont-index">Source: <a href='https://github.com/sapfluxnet/sapfluxnetr/blob/master/R/helpers.R'><code>R/helpers.R</code></a></small>
    <div class="hidden name"><code>diurnal_centroid.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Calculate the diurnal centroid for sapflow variables</p>
    
    </div>

    <pre class="usage"><span class='fu'>diurnal_centroid</span>(<span class='no'>variable</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>variable</th>
      <td><p>A numeric vector containing the sapflow values for a day at a
regular intervals. Missing values are allowed but not recommended</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A numeric value with the diurnal centroid value (0 to 24 h)</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The code for this function has been kindly provided by Jacob Nelson in python
(see https://github.com/jnelson18/FluxnetTools/blob/master/FileS3.py) and has
been translated to a tidy data phylosophy in R to be used inside a
<code><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></code> statement.</p>
    
    <h2 class="hasAnchor" id="diurnal-centroid-algorithm"><a class="anchor" href="#diurnal-centroid-algorithm"></a>Diurnal centroid algorithm</h2>

    
    <p>Given a continuous subdaily sapflow values at regular intervals
\(V = {x_1, ..., x_n}\) to obtain the diurnal centroid each value is
multiplied by its interval index and summed up and divided
by the sum of the values for the day and finally the value is normalized to
24h:</p>
<p>$$
\sum {x_1 * 1, x_2 * 2, ... , x_n * n} / \sum {x_1, x_2, ... , x_n} * (24/n)
$$</p>
<p>With even values for all the intervals (i.e. 100 for all), centroid converges
to 12h at more than 1000 intervals per day. With only 48 (half hourly
measurements) centroid converges to 12.25h and with 24 intervals (hourly
measurements) centroid converges to 12.5h. So, using diurnal centroid value
in half hourly datasets or above can have a considerable error associated.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># dplyr</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>dplyr</span>)</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘dplyr’</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from ‘package:testthat’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    matches</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:stats’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    filter, lag</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:base’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    intersect, setdiff, setequal, union</span></div><div class='input'>
<span class='co'># check convergence to 12h:</span>
<span class='fu'>diurnal_centroid</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/rep'>rep</a></span>(<span class='fl'>1</span>, <span class='fl'>1000</span>)) <span class='co'># 12.012 h</span></div><div class='output co'>#&gt; [1] 12.012</div><div class='input'><span class='fu'>diurnal_centroid</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/rep'>rep</a></span>(<span class='fl'>10000</span>, <span class='fl'>1000</span>)) <span class='co'># 12.012 h, variable scale not affects calculation</span></div><div class='output co'>#&gt; [1] 12.012</div><div class='input'>
<span class='co'># sapflow diurnal centroid</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/data'>data</a></span>(<span class='st'>'ARG_TRE'</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>'sapfluxnetr'</span>)

<span class='fu'><a href='sfn_metrics.html'>sfn_metrics</a></span>(
  <span class='no'>ARG_TRE</span>,
  <span class='kw'>period</span> <span class='kw'>=</span> <span class='st'>'daily'</span>,
  <span class='kw'>.funs</span> <span class='kw'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/funs.html'>funs</a></span>(<span class='fu'>diurnal_centroid</span>(<span class='no'>.</span>),
               <span class='fu'><a href='data_coverage.html'>data_coverage</a></span>(<span class='no'>.</span>, <span class='no'>timestep</span>, <span class='no'>period_minutes</span>)),
  <span class='kw'>solar</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>interval</span> <span class='kw'>=</span> <span class='st'>'general'</span>
)</div><div class='output co'>#&gt; [1] "Crunching data for ARG_TRE. In large datasets this could take a while"
#&gt; [1] "General data for ARG_TRE"</div><div class='output co'>#&gt; $sapf
#&gt; # A time tibble: 13 x 9
#&gt; <span style='color: #949494;'># Index: TIMESTAMP</span><span>
#&gt;    TIMESTAMP           ARG_TRE_Nan_Jt_… ARG_TRE_Nan_Jt_… ARG_TRE_Nan_Jt_…
#&gt;    </span><span style='color: #949494;font-style: italic;'>&lt;dttm&gt;</span><span>                         </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>            </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>            </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 1</span><span> 2009-11-18 </span><span style='color: #949494;'>00:00:00</span><span>             14.1             14.3             13.7
#&gt; </span><span style='color: #BCBCBC;'> 2</span><span> 2009-11-19 </span><span style='color: #949494;'>00:00:00</span><span>             14.4             14.0             13.2
#&gt; </span><span style='color: #BCBCBC;'> 3</span><span> 2009-11-20 </span><span style='color: #949494;'>00:00:00</span><span>             14.0             13.4             12.3
#&gt; </span><span style='color: #BCBCBC;'> 4</span><span> 2009-11-21 </span><span style='color: #949494;'>00:00:00</span><span>             13.6             13.4             12.4
#&gt; </span><span style='color: #BCBCBC;'> 5</span><span> 2009-11-22 </span><span style='color: #949494;'>00:00:00</span><span>             15.1             14.5             14.1
#&gt; </span><span style='color: #BCBCBC;'> 6</span><span> 2009-11-23 </span><span style='color: #949494;'>00:00:00</span><span>             16.0             15.9             15.1
#&gt; </span><span style='color: #BCBCBC;'> 7</span><span> 2009-11-24 </span><span style='color: #949494;'>00:00:00</span><span>             15.5             15.3             14.9
#&gt; </span><span style='color: #BCBCBC;'> 8</span><span> 2009-11-25 </span><span style='color: #949494;'>00:00:00</span><span>             13.5             13.6             13.0
#&gt; </span><span style='color: #BCBCBC;'> 9</span><span> 2009-11-26 </span><span style='color: #949494;'>00:00:00</span><span>             12.4             12.0             12.6
#&gt; </span><span style='color: #BCBCBC;'>10</span><span> 2009-11-27 </span><span style='color: #949494;'>00:00:00</span><span>             15.8             16.0             16.2
#&gt; </span><span style='color: #BCBCBC;'>11</span><span> 2009-11-28 </span><span style='color: #949494;'>00:00:00</span><span>             12.6             12.4             12.4
#&gt; </span><span style='color: #BCBCBC;'>12</span><span> 2009-11-29 </span><span style='color: #949494;'>00:00:00</span><span>             14.9             14.5             14.8
#&gt; </span><span style='color: #BCBCBC;'>13</span><span> 2009-11-30 </span><span style='color: #949494;'>00:00:00</span><span>             16.3             16.4             16.1
#&gt; </span><span style='color: #949494;'># … with 5 more variables: ARG_TRE_Nan_Jt_4_diurnal_centroid </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>,
#&gt; #   ARG_TRE_Nan_Jt_1_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>, ARG_TRE_Nan_Jt_2_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>,
#&gt; #   ARG_TRE_Nan_Jt_3_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>, ARG_TRE_Nan_Jt_4_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; 
#&gt; $env
#&gt; # A time tibble: 13 x 19
#&gt; </span><span style='color: #949494;'># Index: TIMESTAMP</span><span>
#&gt;    TIMESTAMP           ta_diurnal_cent… rh_diurnal_cent… vpd_diurnal_cen…
#&gt;    </span><span style='color: #949494;font-style: italic;'>&lt;dttm&gt;</span><span>                         </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>            </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>            </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 1</span><span> 2009-11-18 </span><span style='color: #949494;'>00:00:00</span><span>             15.6             10.8             14.4
#&gt; </span><span style='color: #BCBCBC;'> 2</span><span> 2009-11-19 </span><span style='color: #949494;'>00:00:00</span><span>             14.0             10.9             13.8
#&gt; </span><span style='color: #BCBCBC;'> 3</span><span> 2009-11-20 </span><span style='color: #949494;'>00:00:00</span><span>             14.3             12.5             12.9
#&gt; </span><span style='color: #BCBCBC;'> 4</span><span> 2009-11-21 </span><span style='color: #949494;'>00:00:00</span><span>             15.2             12.4             13.2
#&gt; </span><span style='color: #BCBCBC;'> 5</span><span> 2009-11-22 </span><span style='color: #949494;'>00:00:00</span><span>             15.9             11.3             14.0
#&gt; </span><span style='color: #BCBCBC;'> 6</span><span> 2009-11-23 </span><span style='color: #949494;'>00:00:00</span><span>             18.2             10.7             14.8
#&gt; </span><span style='color: #BCBCBC;'> 7</span><span> 2009-11-24 </span><span style='color: #949494;'>00:00:00</span><span>             17.0             10.2             15.0
#&gt; </span><span style='color: #BCBCBC;'> 8</span><span> 2009-11-25 </span><span style='color: #949494;'>00:00:00</span><span>             12.9             12.5             12.7
#&gt; </span><span style='color: #BCBCBC;'> 9</span><span> 2009-11-26 </span><span style='color: #949494;'>00:00:00</span><span>             12.7             13.5             12.1
#&gt; </span><span style='color: #BCBCBC;'>10</span><span> 2009-11-27 </span><span style='color: #949494;'>00:00:00</span><span>             15.3             10.5             14.7
#&gt; </span><span style='color: #BCBCBC;'>11</span><span> 2009-11-28 </span><span style='color: #949494;'>00:00:00</span><span>             12.0             13.5             11.9
#&gt; </span><span style='color: #BCBCBC;'>12</span><span> 2009-11-29 </span><span style='color: #949494;'>00:00:00</span><span>             16.7             12.6             13.1
#&gt; </span><span style='color: #BCBCBC;'>13</span><span> 2009-11-30 </span><span style='color: #949494;'>00:00:00</span><span>             15.7             11.6             13.8
#&gt; </span><span style='color: #949494;'># … with 15 more variables: sw_in_diurnal_centroid </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>,
#&gt; #   ws_diurnal_centroid </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>, precip_diurnal_centroid </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>,
#&gt; #   swc_shallow_diurnal_centroid </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>, ppfd_in_diurnal_centroid </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>,
#&gt; #   ext_rad_diurnal_centroid </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>, ta_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>,
#&gt; #   rh_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>, vpd_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>, sw_in_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>,
#&gt; #   ws_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>, precip_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>,
#&gt; #   swc_shallow_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>, ppfd_in_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span style='color: #949494;'>,
#&gt; #   ext_rad_data_coverage </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </div><div class='input'>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#diurnal-centroid-algorithm">Diurnal centroid algorithm</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Jacob Nelson &amp; Víctor Granda</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Víctor Granda, Rafael Poyatos, Víctor Flo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

